<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NYC Taxi - Trip Details</title>
    <link rel="stylesheet" href="css/styles.css">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

    <style>
        /* Popup Styling */
        .popup-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: none;
            align-items: center;
            justify-content: center;
            background: rgba(0, 0, 0, 0.6);
            z-index: 9999;
        }

        .popup-content {
            background: #fff;
            padding: 25px 40px;
            border-radius: 8px;
            text-align: center;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
            max-width: 400px;
        }

        .popup-content button {
            margin-top: 15px;
            padding: 10px 20px;
            border: none;
            background-color: #3498db;
            color: white;
            border-radius: 5px;
            cursor: pointer;
        }

        .popup-content button:hover {
            background-color: #2980b9;
        }
    </style>
</head>

<body>
    <!-- Header Navigation -->
    <header class="header">
        <div class="nav-container">
            <div class="logo">
                <h1>About A Trip</h1>
            </div>
            <nav class="nav-menu">
                <a href="index.html" class="nav-item">Dashboard</a>
                <a href="tripdetails.html" class="nav-item">Trip Details</a>
            </nav>
            <button class="hamburger" id="hamburger">☰</button>
        </div>
    </header>

    <!-- Main Content -->
    <main class="main-content">
        <div class="container">
            <!-- Breadcrumb -->
            <div class="breadcrumb">
                <a href="index.html" class="breadcrumb-link">Dashboard</a>
                <span class="breadcrumb-separator">/</span>
                <span class="breadcrumb-current">Trip Details</span>
            </div>

            <!-- Page Header -->
            <div class="page-header">
                <h2>Trip Details</h2>
                <p class="page-subtitle">View detailed information for the selected trip.</p>
            </div>

            <!-- Trip Overview Section -->
            <section class="analytics-card">
                <div class="card-header">
                    <h3>Trip Overview</h3>
                </div>
                <div class="info-grid">
                    <div class="info-item">
                        <label class="info-label">Trip ID</label>
                        <div class="info-value" id="tripId">Loading...</div>
                    </div>
                    <div class="info-item">
                        <label class="info-label">Vendor</label>
                        <div class="info-value" id="vendor">Loading...</div>
                    </div>
                    <div class="info-item">
                        <label class="info-label">Pickup Time</label>
                        <div class="info-value" id="pickupTime">Loading...</div>
                    </div>
                    <div class="info-item">
                        <label class="info-label">Dropoff Time</label>
                        <div class="info-value" id="dropoffTime">Loading...</div>
                    </div>
                    <div class="info-item">
                        <label class="info-label">Day of Week</label>
                        <div class="info-value" id="dayOfWeek">Loading...</div>
                    </div>
                    <div class="info-item">
                        <label class="info-label">Time of Day</label>
                        <div class="info-value" id="timeOfDay">Loading...</div>
                    </div>
                    <div class="info-item">
                        <label class="info-label">Passenger Count</label>
                        <div class="info-value" id="passengerCount">Loading...</div>
                    </div>
                    <div class="info-item">
                        <label class="info-label">Trip Duration</label>
                        <div class="info-value" id="tripDuration">Loading...</div>
                    </div>
                    <div class="info-item">
                        <label class="info-label">Distance (km)</label>
                        <div class="info-value" id="distanceKm">Loading...</div>
                    </div>
                    <div class="info-item">
                        <label class="info-label">Average Speed (km/h)</label>
                        <div class="info-value" id="averageSpeed">Loading...</div>
                    </div>
                </div>
            </section>

            <!-- Route Visualization Section -->
            <section class="analytics-card">
                <div class="card-header">
                    <h3>Route Visualization</h3>
                </div>
                <div id="map" class="map-container"></div>
            </section>
        </div>
    </main>

    <!-- Footer -->
    <footer class="footer">
        <div class="container">
            <p>&copy; 2024 NYC Taxi Analytics. All rights reserved.</p>
        </div>
    </footer>

    <!-- Popup -->
    <div id="tripAlert" class="popup-overlay">
        <div class="popup-content">
            <p>Please go to the Dashboard and select a trip to view its details.</p>
            <button id="goDashboard">Go to Dashboard</button>
        </div>
    </div>

    <!-- Popup Script (before app scripts) -->
    <script>
        document.addEventListener("DOMContentLoaded", () => {
            const urlParams = new URLSearchParams(window.location.search);
            const tripId = urlParams.get("id");

            if (!tripId) {
                const popup = document.getElementById("tripAlert");
                const goBtn = document.getElementById("goDashboard");

                popup.style.display = "flex";
                goBtn.addEventListener("click", () => {
                    window.location.href = "index.html";
                });
                return;
            }
        });
    </script>

    <!-- Other Scripts -->
    <script src="js/data.js"></script>
    <script src="js/app.js"></script>

    <!-- Trip Page Logic -->
    <script>
        let map, pickupMarker, dropoffMarker, routeLine;

        async function initTripDetails() {
            const urlParams = new URLSearchParams(window.location.search);
            const tripId = urlParams.get('id') || 'id2875421';

            try {
                const tripData = await getTripById(tripId);
                displayTripData(tripData);
                initMap();
                displayRoute(tripData);
            } catch (error) {
                console.error('Error loading trip details:', error);
            }
        }

        function getDayName(dayNumber) {
            const days = ['Sunday', 'Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday'];
            return days[dayNumber] || 'Unknown';
        }

        function formatTimeCategory(category) {
            const categories = {
                'morning': 'Morning',
                'afternoon': 'Afternoon',
                'evening': 'Evening',
                'night': 'Night'
            };
            return categories[category] || category;
        }

        function displayTripData(trip) {
            document.getElementById('tripId').textContent = trip.id;
            document.getElementById('vendor').textContent = `Vendor ${trip.vendor_id}`;
            document.getElementById('pickupTime').textContent = utils.formatDateTime(trip.pickup_datetime);
            document.getElementById('dropoffTime').textContent = utils.formatDateTime(trip.dropoff_datetime);
            document.getElementById('dayOfWeek').textContent = getDayName(trip.day_of_week);
            document.getElementById('timeOfDay').textContent = formatTimeCategory(trip.time_category);
            document.getElementById('passengerCount').textContent = trip.passenger_count;
            document.getElementById('tripDuration').textContent = utils.formatDuration(trip.trip_duration_minutes);
            document.getElementById('distanceKm').textContent = trip.distance_km.toFixed(2) + ' km';
            document.getElementById('averageSpeed').textContent = trip.speed_kmh.toFixed(2) + ' km/h';
        }

        function initMap() {
            map = L.map('map').setView([40.7128, -74.0060], 12);
            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                attribution: '© OpenStreetMap contributors',
                maxZoom: 19
            }).addTo(map);
        }

        function displayRoute(trip) {
            const pickupLatLng = [trip.pickup_latitude, trip.pickup_longitude];
            const dropoffLatLng = [trip.dropoff_latitude, trip.dropoff_longitude];

            const pickupIcon = L.divIcon({
                className: 'custom-marker',
                html: '<div style="background-color: #3498db; width: 24px; height: 24px; border-radius: 50%; border: 3px solid white; box-shadow: 0 2px 4px rgba(0,0,0,0.3);"></div>',
                iconSize: [24, 24],
                iconAnchor: [12, 12]
            });

            const dropoffIcon = L.divIcon({
                className: 'custom-marker',
                html: '<div style="background-color: #e74c3c; width: 24px; height: 24px; border-radius: 50%; border: 3px solid white; box-shadow: 0 2px 4px rgba(0,0,0,0.3);"></div>',
                iconSize: [24, 24],
                iconAnchor: [12, 12]
            });

            if (pickupMarker) map.removeLayer(pickupMarker);
            if (dropoffMarker) map.removeLayer(dropoffMarker);
            if (routeLine) map.removeLayer(routeLine);

            pickupMarker = L.marker(pickupLatLng, { icon: pickupIcon }).addTo(map).bindPopup('<b>Pickup Location</b>');
            dropoffMarker = L.marker(dropoffLatLng, { icon: dropoffIcon }).addTo(map).bindPopup('<b>Dropoff Location</b>');

            routeLine = L.polyline([pickupLatLng, dropoffLatLng], {
                color: '#3498db',
                weight: 4,
                opacity: 0.7,
                dashArray: '10, 10'
            }).addTo(map);

            const bounds = L.latLngBounds([pickupLatLng, dropoffLatLng]);
            map.fitBounds(bounds, { padding: [50, 50] });
        }

        document.addEventListener('DOMContentLoaded', initTripDetails);
        // Hamburger menu
            const hamburger = document.getElementById('hamburger');
            const navMenu = document.querySelector('.nav-menu');

            if (hamburger && navMenu) {
                hamburger.addEventListener('click', () => {
                    navMenu.classList.toggle('active');
                });
            }
    </script>
</body>

</html>